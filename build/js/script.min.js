!function(){const e=document.querySelector(".header__placeholder"),t=document.querySelector(".header__search");if(!t)return;const o=()=>{e.classList.contains("hide"),e.classList.add("hide")};t.value&&o(),t.addEventListener("blur",()=>{t.value?o():(e.classList.contains("hide"),e.classList.remove("hide"))})}(),function(){const e=document.querySelectorAll(".model__link"),t=document.querySelectorAll(".model__image-container");new Swiper(".model__swiper-container",{pagination:{el:".model__swiper-container .model__pagination",type:"bullets",clickable:!0},loop:!0}),e[0]&&(e.forEach(e=>{e.addEventListener("mousedown",t=>{let o=!1;const n=()=>{o=!0},s=t=>{o&&t.preventDefault(),o=!1,e.removeEventListener("mousemove",n),e.removeEventListener("mouseup",s)};e.addEventListener("mousemove",n),e.addEventListener("mouseup",s)}),e.addEventListener("toushstart",t=>{let o=!1;const n=()=>{o=!0},s=t=>{o&&t.preventDefault(),o=!1,e.removeEventListener("touchmove",n),e.removeEventListener("touchend",s)};e.addEventListener("touchmove",n),e.addEventListener("touchend",s)})}),t.forEach(e=>{e.querySelectorAll(".model__image").length>1&&e.classList.add("model__swiper-container")}))}(),function(){const e=document.querySelectorAll(".device__model-item"),t=document.querySelectorAll(".device__wire-popup-mobile"),o=document.querySelectorAll(".device__wire-popup-close"),n=document.querySelector(".device__wire-popup-overlay");if(!e[0])return;e.forEach((e,o)=>{e.addEventListener("click",s=>{e.querySelector(".device__model-not-supported")||s.target.classList.contains("device__wire-popup-close")||(t[o].classList.add("js--show"),n.classList.add("js--show"))})}),o.forEach((e,o)=>{e.addEventListener("click",()=>{t[o].classList.remove("js--show"),n.classList.remove("js--show")})}),n.addEventListener("click",()=>{t.forEach(e=>{e.classList.contains("js--show")&&e.classList.remove("js--show")}),n.classList.remove("js--show")})}(),document.getElementById("animation")&&lottie.loadAnimation({container:document.getElementById("animation"),renderer:"svg",loop:!0,autoplay:!0,path:"data.json"}),function(){var e="https://split.daichicloud.ru/brands/all",t="GET",o=200,n=300,s=function(e,t){var s=new XMLHttpRequest;return s.timeout=1e4,s.responseType="json",s.addEventListener("load",(function(){!function(e){return e.status<o||e.status>n}(s)?e(s.response):t("Данные не загрузились. Причина: "+s.status+" "+s.statusText)})),s.addEventListener("error",(function(){t("Произошла ошибка соединения")})),s.addEventListener("timeout",(function(){t("Запрос не успел выполниться за "+s.timeout+"мс")})),s},r=function(e){e.remove()},a=function(e){var t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t),window.setTimeout(r,2e3,t)};window.backend={load:function(o,n){var r=s(o,n||a);r.open(t,e),r.send()}}}(),jQuery,function(){const e=document.querySelector(".model-choice__brand-list"),t=document.querySelector(".model-choice__brand-choice");if(!e)return;t.addEventListener("click",()=>{if(!e.classList.contains("show"))return e.classList.add("show"),void t.classList.add("opened");e.classList.contains("show")&&(e.classList.remove("show"),t.classList.remove("opened"))}),document.addEventListener("mousedown",o=>{let n=o.target;n.classList.contains("model-choice__brand-choice")||n.classList.contains("model-choice__brand-item")||n.classList.contains("model-choice__brand-list")||!e.classList.contains("show")||(e.classList.remove("show"),t.classList.remove("opened"))})}(),function(){const e=document.querySelector(".equipment__wrapper"),t=document.querySelector(".equipment__container");if(!e)return;(()=>{let o=document.createDocumentFragment(),n=e.cloneNode(!0);n.className="equipment__slide-wrapper",n.classList.add("swiper-wrapper");let s=document.createElement("div");s.classList.add("equipment__pagination"),s.classList.add("swiper-pagination"),o.appendChild(n),o.appendChild(s),t.appendChild(o),t.querySelectorAll(".equipment__item").forEach(e=>{e.classList.add("swiper-slide")}),new Swiper(".equipment__container",{pagination:{el:".equipment__pagination",type:"bullets"},loop:!0})})()}(),function(){const e=document.querySelector(".process__wrapper"),t=document.querySelector(".process__container");if(!e)return;(()=>{let o=document.createDocumentFragment(),n=e.cloneNode(!0);n.className="process__slide-wrapper",n.classList.add("swiper-wrapper");let s=document.createElement("div");s.classList.add("process__pagination"),s.classList.add("swiper-pagination");let r=document.createElement("div");r.className="process__number",r.textContent=1,o.appendChild(n),o.appendChild(s),o.appendChild(r),t.appendChild(o),t.querySelectorAll(".process__item").forEach(e=>{e.classList.add("swiper-slide")});(e=>{const o=t.querySelector(".process__number");e.on("slideChange",()=>{o.textContent=e.realIndex+1})})(new Swiper(".process__container",{pagination:{el:".process__pagination",type:"bullets"},loop:!0}))})()}(),function(){const e=document.querySelector(".add-model__form"),t=document.querySelector("input[name='email']"),o=document.querySelector(".add-model__email-error"),n=document.querySelector("input[name='brand']"),s=document.querySelector(".add-model__brand-error"),r=document.querySelector("input[name='model']"),a=document.querySelector(".add-model__model-error"),i=document.querySelector("input[type='file']"),d=document.querySelector(".add-model__agreement-input"),c=document.querySelector(".add-model__submit"),l=document.querySelector(".add-model__file-progress"),u=document.querySelector(".add-model__bar-current"),m=document.querySelector(".add-model__file-label"),p=document.querySelector(".add-model__file-wrap"),_=document.querySelector(".add-model__file-result"),v=document.querySelector(".add-model__file-image"),h=document.querySelector(".add-model__file-name"),f=document.querySelector(".add-model__file-close");if(!t)return;function L(e){e.preventDefault(),e.stopPropagation()}function g(e){m.classList.add("highlight")}function w(e){m.classList.remove("highlight")}function L(e){e.preventDefault(),e.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach(e=>{p.addEventListener(e,L,!1)}),["dragenter","dragover"].forEach(e=>{p.addEventListener(e,g,!1)}),["dragleave","drop"].forEach(e=>{p.addEventListener(e,w,!1)}),p.addEventListener("drop",(function(e){let t=e.dataTransfer.files;i.files&&i.files[0]&&(i.value="",/safari/i.test(navigator.userAgent)||(i.type="",i.type="file"),_.classList.remove("show"),h.textContent="",v.removeAttribute("src"));i.files=t,k()}),!1);const y=(e,t)=>{e.classList.contains(t)||e.classList.add(t)},E=(e,t)=>{e.classList.contains(t)&&e.classList.remove(t)},q=()=>{t.validity.valid&&""!==n.value&&""!==r.value&&d.checked?c.hasAttribute("disabled")&&c.removeAttribute("disabled"):!c.hasAttribute("disabled")&&c.setAttribute("disabled","")},S=e=>{const t=e.target;y(t,"fill"),""===t.value&&y(t,"mask")},b=e=>{const t=e.target;t.value||E(t,"fill"),E(t,"mask")},k=()=>{(e=>{if(e.files&&e.files[0]){var t=new FileReader;t.onloadstart=function(e){l.classList.add("show")},t.onprogress=function(e){console.log(Math.round(e.loaded/e.total*100)),u.style.width=Math.round(e.loaded/e.total*100)+"%"},t.onload=function(t){v.setAttribute("src",t.target.result),h.textContent=e.files[0].name,!_.classList.contains("show")&&_.classList.add("show"),l.classList.remove("show"),u.style.width=0},t.readAsDataURL(e.files[0])}})(i)};t.addEventListener("focus",S),t.addEventListener("blur",b),t.addEventListener("input",e=>{const n=e.target;t.validity.valid||(y(o,"show"),y(t,"error")),t.validity.valid&&(E(n,"error"),E(o,"show")),""===n.value&&y(n,"mask"),""!==n.value&&E(n,"mask"),q()}),n.addEventListener("focus",S),n.addEventListener("blur",b),n.addEventListener("input",e=>{const t=e.target;""===t.value&&(y(t,"mask"),y(t,"error"),y(s,"show")),""!==t.value&&(E(t,"mask"),E(t,"error"),E(s,"show")),q()}),r.addEventListener("focus",S),r.addEventListener("blur",b),r.addEventListener("input",e=>{const t=e.target;""===t.value&&(y(t,"mask"),y(t,"error"),y(a,"show")),""!==t.value&&(E(t,"mask"),E(t,"error"),E(a,"show")),q()}),i.addEventListener("change",k),f.addEventListener("click",()=>{i.value="",/safari/i.test(navigator.userAgent)||(i.type="",i.type="file"),_.classList.remove("show"),h.textContent="",v.removeAttribute("src")}),d.addEventListener("click",()=>{d.checked?E(d,"error"):y(d,"error"),q()}),c.addEventListener("click",t=>{t.preventDefault(),e.submit()})}(),function(){const e=$(".device__warning-icon"),t=$(".device__stroke-chip"),o=$(".device__stroke-popup"),n=$(".device__warning-popup");e.on("mouseenter",(function(){const e=$(this).next();e.offset().left+e.outerWidth()-$(window).outerWidth()>0&&e.css("transform","translateX(calc(-100% + 40px))")})),e.on("mouseleave",(function(){$(this).next().css("transform","")})),t.on("click",(function(){$(this).next().addClass("opened")})),o.on("click",(function(e){($(e.target).hasClass("device__stroke-popup")||$(e.target).hasClass("device__stroke-popup-close")||$(e.target).parents(".device__stroke-popup-close").length>0)&&$(this).removeClass("opened")})),e.on("click",(function(){$(this).next().addClass("opened")})),n.on("click",(function(e){($(e.target).hasClass("device__warning-popup")||$(e.target).hasClass("device__stroke-popup-close")||$(e.target).parents(".device__stroke-popup-close").length>0)&&$(this).removeClass("opened")}));new Swiper(".model__image-container",{pagination:{el:".model__image-container .model__pagination",type:"bullets",clickable:!0},loop:!0})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlYXJjaC5qcyIsIm1vZGVsLmpzIiwicG9wdXAuanMiLCJhbmltYXRpb24uanMiLCJiYWNrZW5kLmpzIiwic2VsZWN0LmpzIiwiY2hvaWNlLmpzIiwiZXF1aXBtZW50LmpzIiwicHJvY2Vzcy5qcyIsImZvcm0uanMiLCJkZXZpY2UuanMiXSwibmFtZXMiOlsicGxhY2Vob2xkZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbnB1dCIsImhpZGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZCIsInZhbHVlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZSIsIm1vZGVsTGlua3MiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW1hZ2VDb250YWluZXJzIiwiU3dpcGVyIiwicGFnaW5hdGlvbiIsImVsIiwidHlwZSIsImNsaWNrYWJsZSIsImxvb3AiLCJmb3JFYWNoIiwibGluayIsImV2dCIsImlzRHJhZ2VkIiwib25Nb3VzZU1vdmUiLCJvbk1vdXNlVXAiLCJwcmV2ZW50RGVmYXVsdCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblRvdWNoTW92ZSIsIm9uVG91Y2hFbmQiLCJjb250YWluZXIiLCJsZW5ndGgiLCJ3aXJlQnV0dG9ucyIsInBvcHVwcyIsImNsb3NlQnV0dG9ucyIsIm92ZXJsYXkiLCJ3aXJlQnV0dG9uIiwiaWR4IiwidGFyZ2V0IiwiY2xvc2VCdXR0b24iLCJwb3B1cCIsImdldEVsZW1lbnRCeUlkIiwibG90dGllIiwibG9hZEFuaW1hdGlvbiIsInJlbmRlcmVyIiwiYXV0b3BsYXkiLCJwYXRoIiwiUmVxVXJsIiwiUmVxTWV0aG9kIiwiUmVxU3RhdHVzIiwiY3JlYXRlUmVxdWVzdCIsIm9uTG9hZCIsIm9uRXJyb3IiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInRpbWVvdXQiLCJyZXNwb25zZVR5cGUiLCJzdGF0dXMiLCJpc0Vycm9yU3RhdHVzIiwicmVzcG9uc2UiLCJzdGF0dXNUZXh0IiwicmVtb3ZlRWxlbWVudCIsImVsZW1lbnQiLCJvbkFueUVycm9yIiwibWVzc2FnZSIsIm5vZGUiLCJjcmVhdGVFbGVtZW50Iiwic3R5bGUiLCJwb3NpdGlvbiIsImxlZnQiLCJyaWdodCIsImZvbnRTaXplIiwidGV4dENvbnRlbnQiLCJib2R5IiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50Iiwid2luZG93Iiwic2V0VGltZW91dCIsImJhY2tlbmQiLCJsb2FkIiwicmVxIiwib3BlbiIsInNlbmQiLCJqUXVlcnkiLCJicmFuZExpc3QiLCJicmFuZEJ1dHRvbiIsIndyYXBwZXIiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJ3cmFwcGVyTm9kZSIsImNsb25lTm9kZSIsImNsYXNzTmFtZSIsInBhZ2luYXRpb25Ob2RlIiwiYXBwZW5kQ2hpbGQiLCJpdGVtIiwicmVuZGVyU2xpZGVyIiwibnVtYmVyTm9kZSIsInN3aXBlciIsIm51bWJlckZpZWxkIiwib24iLCJyZWFsSW5kZXgiLCJhZGROdW1iZXJpbmciLCJmb3JtIiwiZW1haWxJbnB1dCIsImVtYWlsRXJyb3IiLCJicmFuZElucHV0IiwiYnJhbmRFcnJvciIsIm1vZGVsSW5wdXQiLCJtb2RlbEVycm9yIiwiZmlsZUlucHV0IiwiY2hlY2tib3giLCJzdWJtaXQiLCJwcm9ncmVzcyIsImJhciIsImZpbGVMYWJlbCIsImZpbGVEcm9wQXJlYSIsImZpbGVSZXN1bHQiLCJmaWxlSW1nIiwiZmlsZU5hbWUiLCJmaWxlQ2xlYXIiLCJwcmV2ZW50RGVmYXVsdHMiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwiaGlnaGxpZ2h0IiwidW5oaWdobGlnaHQiLCJldmVudE5hbWUiLCJmaWxlcyIsImRhdGFUcmFuc2ZlciIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJvbkZpbGVDaGFuZ2UiLCJhZGRDbGFzc05hbWUiLCJyZW1vdmVDbGFzc05hbWUiLCJjaGVja0Zvcm0iLCJ2YWxpZGl0eSIsInZhbGlkIiwiY2hlY2tlZCIsImhhc0F0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsIm9uVGV4dEZvY3VzIiwib25UZXh0Qmx1ciIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWRzdGFydCIsIm9ucHJvZ3Jlc3MiLCJjb25zb2xlIiwibG9nIiwiTWF0aCIsInJvdW5kIiwibG9hZGVkIiwidG90YWwiLCJ3aWR0aCIsIm9ubG9hZCIsInJlc3VsdCIsIm5hbWUiLCJyZWFkQXNEYXRhVVJMIiwicmVhZFVybCIsIiR3YXJuaW5nIiwiJCIsIiRjaGlwIiwiJHBvcHVwQ2FibGUiLCIkcG9wdXBXYXJuaW5nIiwiJHBvcHVwIiwidGhpcyIsIm5leHQiLCJvZmZzZXQiLCJvdXRlcldpZHRoIiwiY3NzIiwiYWRkQ2xhc3MiLCJoYXNDbGFzcyIsInBhcmVudHMiLCJyZW1vdmVDbGFzcyJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxNQUFBQSxFQUFBQyxTQUFBQyxjQUFBLHdCQUNBQyxFQUFBRixTQUFBQyxjQUFBLG1CQUVBLElBQUFDLEVBQ0EsT0FHQSxNQUFBQyxFQUFBLEtBQ0FKLEVBQUFLLFVBQUFDLFNBQUEsUUFDQU4sRUFBQUssVUFBQUUsSUFBQSxTQWdCQUosRUFBQUssT0FDQUosSUFHQUQsRUFBQU0saUJBQUEsT0FaQSxLQUNBTixFQUFBSyxNQUNBSixLQU5BSixFQUFBSyxVQUFBQyxTQUFBLFFBQ0FOLEVBQUFLLFVBQUFLLE9BQUEsV0FmQSxHQ0FBLFdBQ0EsTUFBQUMsRUFBQVYsU0FBQVcsaUJBQUEsZ0JBQ0FDLEVBQUFaLFNBQUFXLGlCQUFBLDJCQUdBLElBQUFFLE9BQUEsMkJBQUEsQ0FDQUMsV0FBQSxDQUNBQyxHQUFBLDhDQUNBQyxLQUFBLFVBQ0FDLFdBQUEsR0FFQUMsTUFBQSxJQU1BUixFQUFBLEtBY0FBLEVBQUFTLFFBQUFDLElBQ0FBLEVBQUFaLGlCQUFBLFlBQUFhLElBQ0EsSUFBQUMsR0FBQSxFQUVBLE1BQUFDLEVBQUEsS0FDQUQsR0FBQSxHQUdBRSxFQUFBSCxJQUNBQyxHQUNBRCxFQUFBSSxpQkFHQUgsR0FBQSxFQUNBRixFQUFBTSxvQkFBQSxZ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QSwrQkFBQTVJLE9BQUEsSUFFQWdJLEVBQUFLLE1BQUFRLFlBQUEsYUFJQWQsRUFBQTVELEdBQUEsU0FBQSxXQUNBNkQsRUFBQUssTUFBQUMsT0FFQUksU0FBQSxhQUdBUCxFQUFBaEUsR0FBQSxTQUFBLFNBQUFzQixJQUVBdUMsRUFBQXZDLEVBQUFsRixRQUFBb0ksU0FBQSwwQkFDQVgsRUFBQXZDLEVBQUFsRixRQUFBb0ksU0FBQSwrQkFDQVgsRUFBQXZDLEVBQUFsRixRQUFBcUksUUFBQSwrQkFBQTVJLE9BQUEsSUFFQWdJLEVBQUFLLE1BQUFRLFlBQUEsYUFJQSxJQUFBOUosT0FBQSwwQkFBQSxDQUNBQyxXQUFBLENBQ0FDLEdBQUEsNkNBQ0FDLEtBQUEsVUFDQUMsV0FBQSxHQUVBQyxNQUFBLElBM0RBIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBwbGFjZWhvbGRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXJfX3BsYWNlaG9sZGVyJyk7XG4gIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fc2VhcmNoJyk7XG5cbiAgaWYgKCFpbnB1dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGhpZGUgPSAoKSA9PiB7XG4gICAgIXBsYWNlaG9sZGVyLmNsYXNzTGlzdC5jb250YWlucygnaGlkZScpXG4gICAgICBwbGFjZWhvbGRlci5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gIH07XG5cbiAgY29uc3Qgc2hvdyA9ICgpID0+IHtcbiAgICBwbGFjZWhvbGRlci5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGUnKVxuICAgICAgcGxhY2Vob2xkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICB9O1xuXG4gIGNvbnN0IG9uQmx1ciA9ICgpID0+IHtcbiAgICBpZiAoaW5wdXQudmFsdWUpIHtcbiAgICAgIGhpZGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvdygpO1xuICAgIH1cbiAgfTtcblxuICBpZiAoaW5wdXQudmFsdWUpIHtcbiAgICBoaWRlKCk7XG4gIH07XG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIG9uQmx1cik7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgbW9kZWxMaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kZWxfX2xpbmtcIik7XG4gIGNvbnN0IGltYWdlQ29udGFpbmVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kZWxfX2ltYWdlLWNvbnRhaW5lclwiKTtcblxuICBjb25zdCBpbml0U3dpcGVyID0gKCkgPT4ge1xuICAgIHJldHVybiBuZXcgU3dpcGVyKFwiLm1vZGVsX19zd2lwZXItY29udGFpbmVyXCIsIHtcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6IFwiLm1vZGVsX19zd2lwZXItY29udGFpbmVyIC5tb2RlbF9fcGFnaW5hdGlvblwiLFxuICAgICAgICB0eXBlOiBcImJ1bGxldHNcIixcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgfSk7XG4gIH07XG5cbiAgaW5pdFN3aXBlcigpO1xuXG4gIGlmICghbW9kZWxMaW5rc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIG1vZGVsTGlua3MuZm9yRWFjaCgobGluaykgPT4ge1xuICAvLyAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG5cbiAgLy8gICAgIGNvbnNvbGUubG9nKGV2dC50YXJnZXQudGFnTmFtZSk7XG4gIC8vICAgICBpZiAoZXZ0LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbWcnKSB7XG4gIC8vICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvLyAgICAgfVxuICAvLyAgIH0pXG4gIC8vIH0pO1xuXG4gIG1vZGVsTGlua3MuZm9yRWFjaCgobGluaykgPT4ge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgICBsZXQgaXNEcmFnZWQgPSBmYWxzZTtcblxuICAgICAgY29uc3Qgb25Nb3VzZU1vdmUgPSAoKSA9PiB7XG4gICAgICAgIGlzRHJhZ2VkID0gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9uTW91c2VVcCA9IChldnQpID0+IHtcbiAgICAgICAgaWYgKGlzRHJhZ2VkKSB7XG4gICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpc0RyYWdlZCA9IGZhbHNlO1xuICAgICAgICBsaW5rLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgb25Nb3VzZU1vdmUpO1xuICAgICAgICBsaW5rLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG9uTW91c2VVcCk7XG4gICAgICB9O1xuXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgb25Nb3VzZU1vdmUpO1xuICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBvbk1vdXNlVXApO1xuICAgIH0pO1xuXG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwidG91c2hzdGFydFwiLCAoZXZ0KSA9PiB7XG4gICAgICBsZXQgaXNEcmFnZWQgPSBmYWxzZTtcblxuICAgICAgY29uc3Qgb25Ub3VjaE1vdmUgPSAoKSA9PiB7XG4gICAgICAgIGlzRHJhZ2VkID0gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9uVG91Y2hFbmQgPSAoZXZ0KSA9PiB7XG4gICAgICAgIGlmIChpc0RyYWdlZCkge1xuICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaXNEcmFnZWQgPSBmYWxzZTtcbiAgICAgICAgbGluay5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG9uVG91Y2hNb3ZlKTtcbiAgICAgICAgbGluay5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgb25Ub3VjaEVuZCk7XG4gICAgICB9O1xuXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgb25Ub3VjaE1vdmUpO1xuICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgb25Ub3VjaEVuZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGltYWdlQ29udGFpbmVycy5mb3JFYWNoKChjb250YWluZXIpID0+IHtcbiAgICBjb25zdCBpbWFnZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5tb2RlbF9faW1hZ2VcIik7XG5cbiAgICBpZiAoaW1hZ2VzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibW9kZWxfX3N3aXBlci1jb250YWluZXJcIik7XG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCB3aXJlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZXZpY2VfX21vZGVsLWl0ZW0nKTtcbiAgY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZV9fd2lyZS1wb3B1cC1tb2JpbGUnKTtcbiAgY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZV9fd2lyZS1wb3B1cC1jbG9zZScpO1xuICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRldmljZV9fd2lyZS1wb3B1cC1vdmVybGF5Jyk7XG5cbiAgaWYgKCF3aXJlQnV0dG9uc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGNsb3NlQW55UG9wdXAgPSAoKSA9PiB7XG4gICAgcG9wdXBzLmZvckVhY2goKHBvcHVwKSA9PiB7XG4gICAgICBpZiAocG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy0tc2hvdycpKSB7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLS1zaG93Jyk7XG4gICAgICB9XG4gICAgfSlcbiAgfTtcblxuICB3aXJlQnV0dG9ucy5mb3JFYWNoKCh3aXJlQnV0dG9uLCBpZHgpID0+IHtcbiAgICB3aXJlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgICAgaWYgKHdpcmVCdXR0b24ucXVlcnlTZWxlY3RvcignLmRldmljZV9fbW9kZWwtbm90LXN1cHBvcnRlZCcpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGV2aWNlX193aXJlLXBvcHVwLWNsb3NlJykpIHtcbiAgICAgICAgcG9wdXBzW2lkeF0uY2xhc3NMaXN0LmFkZCgnanMtLXNob3cnKTtcbiAgICAgICAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdqcy0tc2hvdycpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBjbG9zZUJ1dHRvbnMuZm9yRWFjaCgoY2xvc2VCdXR0b24sIGlkeCkgPT4ge1xuICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgcG9wdXBzW2lkeF0uY2xhc3NMaXN0LnJlbW92ZSgnanMtLXNob3cnKTtcbiAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnanMtLXNob3cnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbG9zZUFueVBvcHVwKCk7XG4gICAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdqcy0tc2hvdycpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb24nKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvdHRpZS5sb2FkQW5pbWF0aW9uKHtcbiAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb24nKSwgLy8gdGhlIGRvbSBlbGVtZW50IHRoYXQgd2lsbCBjb250YWluIHRoZSBhbmltYXRpb25cbiAgICByZW5kZXJlcjogJ3N2ZycsXG4gICAgbG9vcDogdHJ1ZSxcbiAgICBhdXRvcGxheTogdHJ1ZSxcbiAgICBwYXRoOiAnZGF0YS5qc29uJyAvLyB0aGUgcGF0aCB0byB0aGUgYW5pbWF0aW9uIGpzb25cbiAgfSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgUmVxVXJsID0ge1xuICAgIEdFVDogJ2h0dHBzOi8vc3BsaXQuZGFpY2hpY2xvdWQucnUvYnJhbmRzL2FsbCcsXG4gICAgLy9QT1NUOiAnaHR0cHM6Ly9qcy5kdW1wLmFjYWRlbXkva2Vrc3RhZ3JhbSdcbiAgfTtcblxuICB2YXIgUmVxTWV0aG9kID0ge1xuICAgIEdFVDogJ0dFVCcsXG4gICAgUE9TVDogJ1BPU1QnXG4gIH07XG5cbiAgdmFyIFJlcVN0YXR1cyA9IHtcbiAgICBPSzogMjAwLFxuICAgIE1VTFRJUExFX0NIT0lDRVM6IDMwMCxcbiAgfTtcblxuICB2YXIgVElNRU9VVCA9IDEwMDAwO1xuXG4gIHZhciBpc0Vycm9yU3RhdHVzID0gZnVuY3Rpb24gKHhocikge1xuICAgIHJldHVybiB4aHIuc3RhdHVzIDwgUmVxU3RhdHVzLk9LXG4gICAgICB8fCB4aHIuc3RhdHVzID4gUmVxU3RhdHVzLk1VTFRJUExFX0NIT0lDRVM7XG4gIH07XG5cbiAgdmFyIGNyZWF0ZVJlcXVlc3QgPSBmdW5jdGlvbiAob25Mb2FkLCBvbkVycm9yKSB7XG4gICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgeGhyLnRpbWVvdXQgPSBUSU1FT1VUO1xuICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XG5cbiAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpc0Vycm9yU3RhdHVzKHhocikpIHtcbiAgICAgICAgb25FcnJvcign0JTQsNC90L3Ri9C1INC90LUg0LfQsNCz0YDRg9C30LjQu9C40YHRjC4g0J/RgNC40YfQuNC90LA6ICcgKyB4aHIuc3RhdHVzICsgJyAnICsgeGhyLnN0YXR1c1RleHQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG9uTG9hZCh4aHIucmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgb25FcnJvcign0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDRgdC+0LXQtNC40L3QtdC90LjRjycpO1xuICAgIH0pO1xuXG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWVvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBvbkVycm9yKCfQl9Cw0L/RgNC+0YEg0L3QtSDRg9GB0L/QtdC7INCy0YvQv9C+0LvQvdC40YLRjNGB0Y8g0LfQsCAnICsgeGhyLnRpbWVvdXQgKyAn0LzRgScpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHhocjtcbiAgfTtcblxuICB2YXIgcmVtb3ZlRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgfTtcblxuICB2YXIgb25BbnlFcnJvciA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBub2RlLnN0eWxlID0gJ3otaW5kZXg6IDEwMDsgbWFyZ2luOiAwIGF1dG87IHRleHQtYWxpZ246IGNlbnRlcjsgYmFja2dyb3VuZC1jb2xvcjogcmVkOyc7XG4gICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgbm9kZS5zdHlsZS5sZWZ0ID0gMDtcbiAgICBub2RlLnN0eWxlLnJpZ2h0ID0gMDtcbiAgICBub2RlLnN0eWxlLmZvbnRTaXplID0gJzMwcHgnO1xuXG4gICAgbm9kZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBub2RlKTtcbiAgICB3aW5kb3cuc2V0VGltZW91dChyZW1vdmVFbGVtZW50LCAyMDAwLCBub2RlKTtcbiAgfTtcblxuICB3aW5kb3cuYmFja2VuZCA9IHtcbiAgICBsb2FkOiBmdW5jdGlvbiAob25Mb2FkLCBvbkVycm9yKSB7XG4gICAgICB2YXIgcmVxID0gY3JlYXRlUmVxdWVzdChvbkxvYWQsIG9uRXJyb3IgfHwgb25BbnlFcnJvcik7XG4gICAgICByZXEub3BlbihSZXFNZXRob2QuR0VULCBSZXFVcmwuR0VUKTtcbiAgICAgIHJlcS5zZW5kKCk7XG4gICAgfSxcblxuICAgIC8vIHNhdmU6IGZ1bmN0aW9uIChkYXRhLCBvbkxvYWQsIG9uRXJyb3IpIHtcbiAgICAvLyAgIHZhciByZXEgPSBjcmVhdGVSZXF1ZXN0KG9uTG9hZCwgb25FcnJvcik7XG4gICAgLy8gICByZXEub3BlbihSZXFNZXRob2QuUE9TVCwgUmVxVXJsLlBPU1QpO1xuICAgIC8vICAgcmVxLnNlbmQoZGF0YSk7XG4gICAgLy8gfVxuICB9O1xufSkoKTtcblxuXG5cblxuIiwiLy8gJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4vLyAgIC8vICQoJy5tb2RlbC1jaG9pY2VfX2JyYW5kLXNlbGVjdCcpLnNlbGVjdDIoe1xuLy8gICAvLyAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiAtMSxcbi8vICAgLy8gfSk7XG5cbi8vICAgLy8gJCgnLm1vZGVsLWNob2ljZV9fc2VyaWVzLXNlbGVjdCcpLnNlbGVjdDIoe1xuLy8gICAvLyAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiAtMSxcbi8vICAgLy8gfSk7XG5cbi8vICAgZnVuY3Rpb24gbWFrZVNlbGVjdChlbGVtZW50KSB7XG4vLyAgICAgJChlbGVtZW50KS5zZWxlY3QyKHtcbi8vICAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiAtMSxcbi8vICAgICB9KTtcbi8vICAgfTtcblxuXG5cblxuLy8gICB3aW5kb3cubWFrZVNlbGVjdCA9IG1ha2VTZWxlY3Q7XG5cbi8vICAgY29uc29sZS5sb2cod2luZG93Lm1ha2VTZWxlY3QpO1xuXG4vLyB9KTtcblxuXG4oZnVuY3Rpb24oJCkge1xuICAvLyBmdW5jdGlvbiBtYWtlU2VsZWN0KGVsZW1lbnRDbGFzcykge1xuICAvLyAgICQoZWxlbWVudENsYXNzKS5zZWxlY3QyKHtcbiAgLy8gICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiAtMSxcbiAgLy8gICB9KTtcbiAgLy8gfTtcblxuICAvLyB3aW5kb3cubWFrZVNlbGVjdCA9IG1ha2VTZWxlY3Q7XG59KShqUXVlcnkpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3Qgc3BsaXRzID0gW1xuICAvLyAgIHtcbiAgLy8gICAgIFwiaWRcIjo3LFxuICAvLyAgICAgXCJ0aXRsZVwiOlwiQXhpb21hXCIsXG4gIC8vICAgICBcInNlcmllc1wiOltcbiAgLy8gICAgICAge1xuICAvLyAgICAgICAgIFwiaWRcIjo2MyxcbiAgLy8gICAgICAgICBcInRpdGxlXCI6XCJBU1hfQVwiXG4gIC8vICAgICAgIH0sXG4gIC8vICAgICAgIHtcbiAgLy8gICAgICAgICBcImlkXCI6NjIsXG4gIC8vICAgICAgICAgXCJ0aXRsZVwiOlwiQVNYX0FaXCJcbiAgLy8gICAgICAgfVxuICAvLyAgICAgXVxuICAvLyAgIH0sXG4gIC8vICAge1wiaWRcIjo2LFwidGl0bGVcIjpcIkRhaWNoaVwiLFwic2VyaWVzXCI6W3tcImlkXCI6NDUsXCJ0aXRsZVwiOlwiQ2FyYm9uIERBX0RWUVwifSx7XCJpZFwiOjQ2LFwidGl0bGVcIjpcIkV2ZXJlc3QgREFfRVZRXCJ9LHtcImlkXCI6NDMsXCJ0aXRsZVwiOlwiUGVhayBEQV9BVlFTXCJ9LHtcImlkXCI6NDIsXCJ0aXRsZVwiOlwiWC10cmVtZSBQZWFrIERBX0FWUVNcIn1dfSxcbiAgLy8gICB7XCJpZFwiOjEsXCJ0aXRsZVwiOlwiRGFpa2luXCIsXCJzZXJpZXNcIjpbe1wiaWRcIjoxMSxcInRpdGxlXCI6XCJDb21mb3JhIEZUWC1KXFwvR1ZcIn0se1wiaWRcIjoyNixcInRpdGxlXCI6XCJDb21mb3JhIEZUWFAtSzNcIn0se1wiaWRcIjoyNyxcInRpdGxlXCI6XCJDb21mb3JhIEZUWFAtTFwifSx7XCJpZFwiOjI4LFwidGl0bGVcIjpcIkNvbWZvcmEgRlRYUC1NXCJ9LHtcImlkXCI6MjMsXCJ0aXRsZVwiOlwiRW11cmEgRlRYRy1MXCJ9LHtcImlkXCI6MTgsXCJ0aXRsZVwiOlwiRW11cmEgRlRYSi1NXCJ9LHtcImlkXCI6MjAsXCJ0aXRsZVwiOlwiRkxYUy1CXCJ9LHtcImlkXCI6MTYsXCJ0aXRsZVwiOlwiRlRYQi1CXCJ9LHtcImlkXCI6NjUsXCJ0aXRsZVwiOlwiRlRYUy1FXCJ9LHtcImlkXCI6NjQsXCJ0aXRsZVwiOlwiRlRYUy1KXFwvR1wifSx7XCJpZFwiOjIxLFwidGl0bGVcIjpcIkZWWE0tRlwifSx7XCJpZFwiOjIyLFwidGl0bGVcIjpcIkZWWFMtRlwifSx7XCJpZFwiOjE5LFwidGl0bGVcIjpcIk5leHVyYSBGVlhHLUtcIn0se1wiaWRcIjoyNCxcInRpdGxlXCI6XCJQZXJmZXJhIEZUWE0tTlwifSx7XCJpZFwiOjI1LFwidGl0bGVcIjpcIlBlcmZlcmEgRlRYUy1LXCJ9LHtcImlkXCI6MSxcInRpdGxlXCI6XCJTZW5zaXJhIEZUWEItQ1wifV19LFxuICAvLyAgIHtcImlkXCI6MixcInRpdGxlXCI6XCJLZW50YXRzdVwiLFwic2VyaWVzXCI6W3tcImlkXCI6NDksXCJ0aXRsZVwiOlwiQnJhdm8gIEtTR0JfSEZBTlwifSx7XCJpZFwiOjUwLFwidGl0bGVcIjpcIkJyYXZvICBLU0dCQV9IWkFOXCJ9LHtcImlkXCI6NTYsXCJ0aXRsZVwiOlwiS01HQkFfSFpBTlwifSx7XCJpZFwiOjU3LFwidGl0bGVcIjpcIktNR0JCX0haQU5cIn0se1wiaWRcIjo1MixcInRpdGxlXCI6XCJUZWFtICBLU0dUX0haQU5cIn0se1wiaWRcIjo0NyxcInRpdGxlXCI6XCJUaXRhbiBHZW5lc2lzIEtTR1hcIn0se1wiaWRcIjo1MSxcInRpdGxlXCI6XCJUdXJpbiBLU0dVX0haQU5cIn1dfSxcbiAgLy8gICB7XCJpZFwiOjgsXCJ0aXRsZVwiOlwiTWlkZWFcIixcInNlcmllc1wiOlt7XCJpZFwiOjYxLFwidGl0bGVcIjpcIkJsYW5jIE1TTUFcIn0se1wiaWRcIjo2MCxcInRpdGxlXCI6XCJCbGFuYyBNU01BIEVSUCAoTUEpXCJ9LHtcImlkXCI6NTksXCJ0aXRsZVwiOlwiTWlzc2lvbiBNU01CIChNQilcIn0se1wiaWRcIjo1OCxcInRpdGxlXCI6XCJVbHRpbWF0ZSBDb21mb3J0IE1TTVQgKE1UKVwifV19XTtcblxuXG4gIC8vbGV0IHNlcmllc05hbWUgPSAnJztcbiAgLy9sZXQgYnJhbmROYW1lID0gJyc7XG5cbiAgY29uc3QgYnJhbmRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGVsLWNob2ljZV9fYnJhbmQtbGlzdCcpO1xuICBjb25zdCBicmFuZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RlbC1jaG9pY2VfX2JyYW5kLWNob2ljZScpO1xuICAvL2NvbnN0IGJyYW5kU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGVsLWNob2ljZV9fc2VsZWN0LWJyYW5kJyk7XG5cbiAgaWYgKCFicmFuZExpc3QpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvL2xldCBjdXJyZW50QnJhbmRJZHggPSAtMTtcbiAgLy9sZXQgY3VycmVudE9wdGlvbklkeCA9IC0xO1xuXG4gIC8vY29uc3QgYnJhbmRTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kZWwtY2hvaWNlX19icmFuZC1zZWxlY3QnKTtcbiAgLy9jb25zdCBzZXJpZXNXcmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGVsLWNob2ljZV9fc2VyaWVzLXdyYXBwZXInKTtcbiAgLy9jb25zdCBzZXJpZXNUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZXJpZXMnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RlbC1jaG9pY2VfX3Nlcmllcy1zZWxlY3QnKTtcblxuICAvL2NvbnN0IGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kZWwtY2hvaWNlX19saW5rJyk7XG5cbiAgLy8gY29uc3QgZ2V0SHJlZiA9IChzZXJpZXMpID0+IHtcbiAgLy8gICBsZXQgaHJlZiA9ICcnO1xuXG4gIC8vICAgUEFHRVMuZm9yRWFjaCgocGFnZSkgPT4ge1xuICAvLyAgICAgaWYgKGhyZWYgPT09ICcnKSB7XG4gIC8vICAgICAgIGlmIChzZXJpZXMudG9Mb3dlckNhc2UoKS5pbmRleE9mKHBhZ2UpICE9PSAtMSkge1xuICAvLyAgICAgICAgIGhyZWYgPSBwYWdlO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSk7XG5cbiAgLy8gICByZXR1cm4gaHJlZiA9PT0gJycgPyAnJyA6IGhyZWYgKyAnLmh0bWwnO1xuICAvLyB9O1xuXG4gIGNvbnN0IG9uQnJhbmRDbGljayA9ICgpID0+IHtcbiAgICBpZiAoIWJyYW5kTGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSkge1xuICAgICAgYnJhbmRMaXN0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICAgIGJyYW5kQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ29wZW5lZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChicmFuZExpc3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHtcbiAgICAgIGJyYW5kTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgICBicmFuZEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcbiAgICB9XG4gICAgLy8galF1ZXJ5KCcubW9kZWwtY2hvaWNlX19icmFuZC1saXN0JykubUN1c3RvbVNjcm9sbGJhcih7XG4gICAgLy8gICBzZXRIZWlnaHQ6IDE4OSxcbiAgICAvLyAgIGF1dG9IaWRlU2Nyb2xsYmFyOiBmYWxzZSxcbiAgICAvLyAgIHRoZW1lOiAnZGFyaycsXG4gICAgLy8gICBtb3VzZVdoZWVsUGl4ZWxzOiAyMDAsXG4gICAgLy8gICBjb250ZW50VG91Y2hTY3JvbGw6IHRydWVcbiAgICAvLyB9KTtcbiAgfTtcblxuICAvLyBjb25zdCBvblNlcmllc0NsaWNrID0gKCkgPT4ge1xuICAvLyAgIGlmICghc2VyaWVzTGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSkge1xuICAvLyAgICAgc2VyaWVzTGlzdC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gIC8vICAgICBzZXJpZXNCdXR0b24uY2xhc3NMaXN0LmFkZCgnb3BlbmVkJyk7XG4gIC8vICAgICAvLyBjb25zb2xlLmxvZyhzZXJpZXNMaXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSAtIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gIC8vICAgICByZXR1cm47XG4gIC8vICAgfVxuXG4gIC8vICAgaWYgKHNlcmllc0xpc3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHtcbiAgLy8gICAgIHNlcmllc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAvLyAgICAgc2VyaWVzQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW5lZCcpO1xuICAvLyAgIH1cbiAgLy8gfTtcblxuICBjb25zdCBvbk91dHNpZGVDbGljayA9IChldnQpID0+IHtcbiAgICBsZXQgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcblxuICAgIGlmIChcbiAgICAgICF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RlbC1jaG9pY2VfX2JyYW5kLWNob2ljZScpXG4gICAgICAmJiAhdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kZWwtY2hvaWNlX19icmFuZC1pdGVtJylcbiAgICAgICYmICF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RlbC1jaG9pY2VfX2JyYW5kLWxpc3QnKVxuICAgICAgJiYgYnJhbmRMaXN0LmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpXG4gICAgKSB7XG4gICAgICBicmFuZExpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgICAgYnJhbmRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnb3BlbmVkJyk7XG4gICAgfVxuXG4gICAgLy8gaWYgKFxuICAgIC8vICAgIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGVsLWNob2ljZV9fc2VyaWVzLWNob2ljZScpXG4gICAgLy8gICAmJiAhdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kZWwtY2hvaWNlX19zZXJpZXMtaXRlbScpXG4gICAgLy8gICAmJiAhdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kZWwtY2hvaWNlX19zZXJpZXMtbGlzdCcpXG4gICAgLy8gICAmJiBzZXJpZXNMaXN0LmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpXG4gICAgLy8gKSB7XG4gICAgLy8gICBzZXJpZXNMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAvLyAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcbiAgICAvLyB9XG4gIH07XG5cblxuICAgIC8vIGxldCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAvLyBsZXQgaSA9IDA7XG5cbiAgICAvLyBhcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIC8vICAgbGV0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgIC8vICAgbm9kZS50ZXh0Q29udGVudCA9IGl0ZW1bJ3RpdGxlJ107XG4gICAgLy8gICBub2RlLmNsYXNzTGlzdC5hZGQoJ21vZGVsLWNob2ljZV9fYnJhbmQtaXRlbScpO1xuICAgIC8vICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpKTtcbiAgICAvLyAgIGkrKztcbiAgICAvLyAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgLy8gICAvLyBsZXQgc2VyaWVzU2VsZWN0ID0gc2VyaWVzVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIC8vICAgLy8gc2VyaWVzU2VsZWN0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgIC8vICAgLy8gc2VyaWVzU2VsZWN0LnNldEF0dHJpYnV0ZSgnbmFtZScsIGl0ZW1bJ3RpdGxlJ10pO1xuXG4gICAgLy8gICAvLyBpdGVtLnNlcmllcy5mb3JFYWNoKChzZXJpZSkgPT4ge1xuICAgIC8vICAgLy8gICBsZXQgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIC8vICAgLy8gICBub2RlLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBzZXJpZVsndGl0bGUnXSk7XG4gICAgLy8gICAvLyAgIG5vZGUudGV4dENvbnRlbnQgPSBzZXJpZVsndGl0bGUnXTtcbiAgICAvLyAgIC8vICAgc2VyaWVzU2VsZWN0LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIC8vICAgLy8gfSk7XG5cbiAgICAvLyAgIC8vIHNlcmllc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc2VyaWVzU2VsZWN0KTtcbiAgICAvLyB9KTtcblxuICAgIC8vIGJyYW5kTGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cblxuICAgIC8vIGxldCBmcmFnbWVudDEgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgLy8gbGV0IGogPSAwO1xuXG4gICAgLy8gYXJyLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAvLyAgIGxldCBub2RlMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIC8vICAgbm9kZTEudGV4dENvbnRlbnQgPSBpdGVtWyd0aXRsZSddO1xuICAgIC8vICAgbm9kZTEuY2xhc3NMaXN0LmFkZCgnbW9kZWwtY2hvaWNlX19icmFuZC1vcHRpb24nKTtcbiAgICAvLyAgIG5vZGUxLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGkpO1xuICAgIC8vICAgaisrO1xuICAgIC8vICAgZnJhZ21lbnQxLmFwcGVuZENoaWxkKG5vZGUxKTtcblxuICAgIC8vICAgLy8gbGV0IHNlcmllc1NlbGVjdCA9IHNlcmllc1RlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgICAvLyAgIC8vIHNlcmllc1NlbGVjdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAvLyAgIC8vIHNlcmllc1NlbGVjdC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBpdGVtWyd0aXRsZSddKTtcblxuICAgIC8vICAgLy8gaXRlbS5zZXJpZXMuZm9yRWFjaCgoc2VyaWUpID0+IHtcbiAgICAvLyAgIC8vICAgbGV0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAvLyAgIC8vICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgc2VyaWVbJ3RpdGxlJ10pO1xuICAgIC8vICAgLy8gICBub2RlLnRleHRDb250ZW50ID0gc2VyaWVbJ3RpdGxlJ107XG4gICAgLy8gICAvLyAgIHNlcmllc1NlbGVjdC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAvLyAgIC8vIH0pO1xuXG4gICAgLy8gICAvLyBzZXJpZXNXcmFwcGVyLmFwcGVuZENoaWxkKHNlcmllc1NlbGVjdCk7XG4gICAgLy8gfSk7XG5cbiAgICAvLyBicmFuZFNlbGVjdC5hcHBlbmRDaGlsZChmcmFnbWVudDEpO1xuXG5cblxuICAgIC8vIGNvbnN0IG9uQnJhbmRJdGVtQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgLy8gICBsZXQgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcbiAgICAvLyAgIGxldCBpZHggPSArdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgLy8gICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kZWwtY2hvaWNlX19icmFuZC1pdGVtJykpIHtcbiAgICAvLyAgICAgaWYgKGN1cnJlbnRCcmFuZElkeCA9PT0gaWR4KSB7XG4gICAgLy8gICAgICAgYnJhbmRMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAvLyAgICAgICBicmFuZEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcbiAgICAvLyAgICAgfVxuXG4gICAgLy8gICAgIGlmIChjdXJyZW50QnJhbmRJZHggIT09IGlkeCkge1xuICAgIC8vICAgICAgIHNlcmllc0xpc3QuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAvLyAgICAgICBzZXJpZXNCdXR0b24udGV4dENvbnRlbnQgPSAn0JLRi9Cx0YDQsNGC0Ywg0LjQtyDRgdC/0LjRgdC60LAnO1xuICAgIC8vICAgICAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuXG4gICAgLy8gICAgICAgbGV0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIC8vICAgICAgIGxldCBpZHggPSArdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgLy8gICAgICAgYXJyW2lkeF0uc2VyaWVzLmZvckVhY2goKHNlcmllKSA9PiB7XG4gICAgLy8gICAgICAgICBsZXQgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgLy8gICAgICAgICBub2RlLnRleHRDb250ZW50ID0gc2VyaWVbJ3RpdGxlJ107XG4gICAgLy8gICAgICAgICBub2RlLmNsYXNzTGlzdC5hZGQoJ21vZGVsLWNob2ljZV9fc2VyaWVzLWl0ZW0nKTtcbiAgICAvLyAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIC8vICAgICAgIH0pO1xuXG4gICAgLy8gICAgICAgc2VyaWVzTGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgLy8gICAgICAgY3VycmVudEJyYW5kSWR4ID0gaWR4O1xuXG4gICAgLy8gICAgICAgYnJhbmRCdXR0b24udGV4dENvbnRlbnQgPSB0YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgLy8gICAgICAgYnJhbmROYW1lID0gdGFyZ2V0LnRleHRDb250ZW50O1xuICAgIC8vICAgICAgIGlmICghYnJhbmRCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgLy8gICAgICAgICBicmFuZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgIC8vICAgICAgIH1cblxuICAgIC8vICAgICAgIGlmIChzZXJpZXNCdXR0b24uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgLy8gICAgICAgICBzZXJpZXNCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIC8vICAgICAgIH1cblxuICAgIC8vICAgICAgIGJyYW5kTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgLy8gICAgICAgYnJhbmRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnb3BlbmVkJyk7XG5cbiAgICAvLyAgICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgLy8gICAgICAgbGluay5yZW1vdmVBdHRyaWJ1dGUoJ2hyZWYnKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cblxuICAgIC8vIGNvbnN0IG9uQnJhbmRDaGFuZ2UgPSAoZXZ0KSA9PiB7XG4gICAgLy8gICBjdXJyZW50T3B0aW9uSWR4ID0gZXZ0LnRhcmdldC5zZWxlY3RlZEluZGV4IC0gMTtcbiAgICAvLyAgIHNlcmllc1NlbGVjdC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vICAgc2VyaWVzQnV0dG9uLnRleHRDb250ZW50ID0gJ9CS0YvQsdGA0LDRgtGMINC40Lcg0YHQv9C40YHQutCwJztcbiAgICAvLyAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuXG4gICAgLy8gICBsZXQgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIC8vICAgbm9kZS50ZXh0Q29udGVudCA9ICcnO1xuICAgIC8vICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIC8vICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgJycpO1xuICAgIC8vICAgbm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgLy8gICBzZXJpZXNTZWxlY3QuYXBwZW5kQ2hpbGQobm9kZSk7XG5cbiAgICAvLyAgIGxldCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgIC8vICAgaWYgKHNlcmllc1NlbGVjdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAvLyAgICAgc2VyaWVzU2VsZWN0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAvLyAgIH1cblxuXG4gICAgLy8gICBhcnJbY3VycmVudE9wdGlvbklkeF0uc2VyaWVzLmZvckVhY2goKHNlcmllKSA9PiB7XG4gICAgLy8gICAgIGxldCBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgLy8gICAgIG5vZGUudGV4dENvbnRlbnQgPSBzZXJpZVsndGl0bGUnXTtcbiAgICAvLyAgICAgbm9kZS5jbGFzc0xpc3QuYWRkKCdtb2RlbC1jaG9pY2VfX3Nlcmllcy1vcHRpb24nKTtcbiAgICAvLyAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgLy8gICB9KTtcblxuICAgIC8vICAgc2VyaWVzU2VsZWN0LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgIC8vICAgYnJhbmRCdXR0b24udGV4dENvbnRlbnQgPSBldnQudGFyZ2V0LnZhbHVlO1xuICAgIC8vICAgYnJhbmROYW1lID0gZXZ0LnRhcmdldC52YWx1ZTtcbiAgICAvLyAgIGlmICghYnJhbmRCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgLy8gICAgIGJyYW5kQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgLy8gICB9XG5cbiAgICAvLyAgIGxpbmsuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICAvLyAgIGxpbmsucmVtb3ZlQXR0cmlidXRlKCdocmVmJyk7XG4gICAgLy8gfVxuXG4gICAgLy8gY29uc3Qgb25TZXJpZXNJdGVtQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgLy8gICBsZXQgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcblxuICAgIC8vICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGVsLWNob2ljZV9fc2VyaWVzLWl0ZW0nKSkge1xuICAgIC8vICAgICBzZXJpZXNCdXR0b24udGV4dENvbnRlbnQgPSB0YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgLy8gICAgIGlmICghc2VyaWVzQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSkge1xuICAgIC8vICAgICAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgIC8vICAgICB9XG5cbiAgICAvLyAgICAgc2VyaWVzTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgLy8gICAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcblxuICAgIC8vICAgICBsaW5rLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgLy8gICAgIHNlcmllc05hbWUgPSB0YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgLy8gICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgZ2V0SHJlZihzZXJpZXNOYW1lKSk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gICAgLy8gY29uc3Qgb25TZXJpZXNDaGFuZ2UgPSAoZXZ0KSA9PiB7XG4gICAgLy8gICBzZXJpZXNCdXR0b24udGV4dENvbnRlbnQgPSBldnQudGFyZ2V0LnZhbHVlO1xuICAgIC8vICAgaWYgKCFzZXJpZXNCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgLy8gICAgIHNlcmllc0J1dHRvbi5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgIC8vICAgfVxuXG4gICAgLy8gICBsaW5rLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgLy8gICBzZXJpZXNOYW1lID0gZXZ0LnRhcmdldC52YWx1ZTtcbiAgICAvLyAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgZ2V0SHJlZihzZXJpZXNOYW1lKSk7XG4gICAgLy8gfVxuXG4gICAgLy8gY29uc3Qgb25MaW5rQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgLy8gICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyAgIGxldCBocmVmID0gZXZ0LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcblxuICAgIC8vICAgaWYgKGhyZWYgPT09ICcnKSB7XG4gICAgLy8gICAgIGFsZXJ0KCfQmNC90YHRgtGA0YPQutGG0LjRjyDQv9C+INGD0YHRgtCw0L3QvtCy0LrQtSBXaS1GaSDQutC+0L3RgtGA0L7Qu9C70LXRgNCwINC00LvRjyDQtNCw0L3QvdC+0Lkg0YHQtdGA0LjQuCDQutC+0L3QtNC40YbQuNC+0L3QtdGA0LAg0LIg0YHQutC+0YDQvtC8INCy0YDQtdC80LXQvdC4INC/0L7Rj9Cy0LjRgtGB0Y8uJyk7XG5cbiAgICAvLyAgICAgcmV0dXJuO1xuICAgIC8vICAgfVxuXG4gICAgLy8gICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gaHJlZjtcbiAgICAvLyB9O1xuXG4gICAgLy9sZXQgc3BsaXRzRGF0YSA9IGJhY2tlbmQubG9hZChnZXREYXRhKTtcblxuICAgIC8vYnJhbmRTZWxlY3QuYXBwZW5kQ2hpbGQobWFrZU9wdGlvbk5vZGUoc3BsaXRzKSk7XG4gICAgLy9tYWtlT3B0aW9uTm9kZShzcGxpdHMpO1xuICAgIC8vYmFja2VuZC5sb2FkKG1ha2VPcHRpb25Ob2RlKTtcblxuXG4gICAgLy8gbWFrZVNlbGVjdChicmFuZENsYXNzKTtcbiAgICAvLyBtYWtlU2VsZWN0KHNlcmllc0NsYXNzKTtcblxuICAgIC8vIGpRdWVyeShicmFuZENsYXNzKS5zZWxlY3QyKCdvcGVuJyk7XG4gICAgLy8galF1ZXJ5KGJyYW5kQ2xhc3MpLnNlbGVjdDIoJ2Nsb3NlJyk7XG5cblxuICAgIC8vIGNvbnN0IHNlcmllc1NlbGVjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kZWwtY2hvaWNlX19zZXJpZXMtc2VsZWN0Jyk7XG5cblxuICAgIC8vIGNvbnN0IGhpZGVTZXJpZXMgPSAoKSA9PiB7XG4gICAgLy8gICBzZXJpZXNTZWxlY3RzLmZvckVhY2goKHNlbGVjdCkgPT4ge1xuICAgIC8vICAgICBpZiAoIXNlbGVjdC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7XG4gICAgLy8gICAgICAgc2VsZWN0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgIC8vICAgICAgIHNlbGVjdC5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH0pXG4gICAgLy8gfTtcblxuICAgIC8vIGNvbnN0IHNob3dTZXJpZXMgPSAoaWR4KSA9PiB7XG4gICAgLy8gICBzZXJpZXNTZWxlY3RzW2lkeF0uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgLy8gICBzZXJpZXNTZWxlY3RzW2lkeF0uc2V0QXR0cmlidXRlKCdpZCcsICdzZXJpZXMtc2VsZWN0Jyk7XG4gICAgLy8gfTtcblxuICAgIC8vIGpRdWVyeShicmFuZENsYXNzKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIC8vICAgbGV0IGlkeCA9ICtqUXVlcnkoJy5tb2RlbC1jaG9pY2VfX2JyYW5kLXNlbGVjdCBvcHRpb246c2VsZWN0ZWQnKS5hdHRyKCdkYXRhLWlkJyk7XG5cbiAgICAvLyAgIGhpZGVTZXJpZXMoKTtcbiAgICAvLyAgIHNob3dTZXJpZXMoaWR4ICsgMSk7XG5cbiAgICAvLyAgIGpRdWVyeSgnI3Nlcmllcy1zZWxlY3QnKS5zZWxlY3QyKCdvcGVuJyk7XG4gICAgLy8gICBqUXVlcnkoJyNzZXJpZXMtc2VsZWN0Jykuc2VsZWN0MignY2xvc2UnKTtcblxuICAgIC8vICAgalF1ZXJ5KCcubW9kZWwtY2hvaWNlX19icmFuZC1zZWxlY3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAvLyAgIGpRdWVyeSgnLm1vZGVsLWNob2ljZV9fc2VyaWVzLXNlbGVjdCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgIC8vIH0pO1xuXG4gICAgLy8galF1ZXJ5KHNlcmllc0NsYXNzKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIC8vICAgaWYgKGxpbmsuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpKSB7XG4gICAgLy8gICAgIGxpbmsuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICAvLyAgIH1cblxuICAgIC8vICAgbGV0IHZhbHVlID0galF1ZXJ5KGV2dC50YXJnZXQpLmNoaWxkcmVuKCdvcHRpb246c2VsZWN0ZWQnKS50ZXh0KCk7XG4gICAgLy8gICBzZXJpZXNOYW1lID0gdmFsdWU7XG5cblxuICAgIC8vICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCBzZXJpZXNOYW1lKTtcblxuICAgIC8vICAgalF1ZXJ5KCcubW9kZWwtY2hvaWNlX19zZXJpZXMtc2VsZWN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgLy8gfSk7XG5cbiAgICAvL1Jlc2l6ZS5pbml0KCk7XG4gICAgLy9SZXNpemUuYWRkTGlzdGVuZXIoKTtcblxuICAgIGJyYW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CcmFuZENsaWNrKTtcbiAgICAvL3Nlcmllc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uU2VyaWVzQ2xpY2spO1xuICAgIC8vIGJyYW5kTGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQnJhbmRJdGVtQ2xpY2spO1xuICAgIC8vIHNlcmllc0xpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblNlcmllc0l0ZW1DbGljayk7XG4gICAgLy8gYnJhbmRTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25CcmFuZENoYW5nZSk7XG4gICAgLy8gc2VyaWVzU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uU2VyaWVzQ2hhbmdlKTtcbiAgICAvLyBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25MaW5rQ2xpY2spO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uT3V0c2lkZUNsaWNrKTtcblxuXG4gIC8vYmFja2VuZC5sb2FkKG1ha2VPcHRpb25Ob2RlKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZXF1aXBtZW50X193cmFwcGVyJyk7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lcXVpcG1lbnRfX2NvbnRhaW5lcicpO1xuXG4gIGlmKCF3cmFwcGVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgaW5pdFN3aXBlciA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFN3aXBlcignLmVxdWlwbWVudF9fY29udGFpbmVyJywge1xuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5lcXVpcG1lbnRfX3BhZ2luYXRpb24nLFxuICAgICAgICB0eXBlOiAnYnVsbGV0cycsXG4gICAgICB9LFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhZGRTbGlkZUNsYXNzID0gKGVsZW1lbnQpID0+IHtcbiAgICBsZXQgaXRlbXMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lcXVpcG1lbnRfX2l0ZW0nKTtcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1zbGlkZScpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlclNsaWRlciA9ICgpID0+IHtcbiAgICBsZXQgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICBsZXQgd3JhcHBlck5vZGUgPSB3cmFwcGVyLmNsb25lTm9kZSh0cnVlKTtcbiAgICB3cmFwcGVyTm9kZS5jbGFzc05hbWUgPSAnZXF1aXBtZW50X19zbGlkZS13cmFwcGVyJztcbiAgICB3cmFwcGVyTm9kZS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItd3JhcHBlcicpO1xuXG4gICAgbGV0IHBhZ2luYXRpb25Ob2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcGFnaW5hdGlvbk5vZGUuY2xhc3NMaXN0LmFkZCgnZXF1aXBtZW50X19wYWdpbmF0aW9uJyk7XG4gICAgcGFnaW5hdGlvbk5vZGUuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXBhZ2luYXRpb24nKTtcblxuICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHdyYXBwZXJOb2RlKTtcbiAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwYWdpbmF0aW9uTm9kZSk7XG5cbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgIGFkZFNsaWRlQ2xhc3MoY29udGFpbmVyKTtcblxuICAgIGluaXRTd2lwZXIoKTtcbiAgfTtcblxuICByZW5kZXJTbGlkZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2Nlc3NfX3dyYXBwZXInKTtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2Nlc3NfX2NvbnRhaW5lcicpO1xuXG4gIGlmICghd3JhcHBlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGluaXRTd2lwZXIgPSAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBTd2lwZXIoJy5wcm9jZXNzX19jb250YWluZXInLCB7XG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLnByb2Nlc3NfX3BhZ2luYXRpb24nLFxuICAgICAgICB0eXBlOiAnYnVsbGV0cycsXG4gICAgICB9LFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhZGRTbGlkZUNsYXNzID0gKGVsZW1lbnQpID0+IHtcbiAgICBsZXQgaXRlbXMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wcm9jZXNzX19pdGVtJyk7XG4gICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItc2xpZGUnKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhZGROdW1iZXJpbmcgPSAoc3dpcGVyKSA9PiB7XG4gICAgY29uc3QgbnVtYmVyRmllbGQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnByb2Nlc3NfX251bWJlcicpO1xuXG4gICAgc3dpcGVyLm9uKCdzbGlkZUNoYW5nZScsICgpID0+IHtcbiAgICAgIG51bWJlckZpZWxkLnRleHRDb250ZW50ID0gc3dpcGVyLnJlYWxJbmRleCArIDE7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyU2xpZGVyID0gKCkgPT4ge1xuICAgIGxldCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgIGxldCB3cmFwcGVyTm9kZSA9IHdyYXBwZXIuY2xvbmVOb2RlKHRydWUpO1xuICAgIHdyYXBwZXJOb2RlLmNsYXNzTmFtZSA9ICdwcm9jZXNzX19zbGlkZS13cmFwcGVyJztcbiAgICB3cmFwcGVyTm9kZS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItd3JhcHBlcicpO1xuXG4gICAgbGV0IHBhZ2luYXRpb25Ob2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcGFnaW5hdGlvbk5vZGUuY2xhc3NMaXN0LmFkZCgncHJvY2Vzc19fcGFnaW5hdGlvbicpO1xuICAgIHBhZ2luYXRpb25Ob2RlLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1wYWdpbmF0aW9uJyk7XG5cbiAgICBsZXQgbnVtYmVyTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIG51bWJlck5vZGUuY2xhc3NOYW1lID0gJ3Byb2Nlc3NfX251bWJlcic7XG4gICAgbnVtYmVyTm9kZS50ZXh0Q29udGVudCA9IDE7XG5cbiAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh3cmFwcGVyTm9kZSk7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQocGFnaW5hdGlvbk5vZGUpO1xuICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG51bWJlck5vZGUpO1xuXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbiAgICBhZGRTbGlkZUNsYXNzKGNvbnRhaW5lcik7XG5cbiAgICBjb25zdCBwcm9jZXNzU3dpcGVyID0gaW5pdFN3aXBlcigpO1xuICAgIGFkZE51bWJlcmluZyhwcm9jZXNzU3dpcGVyKTtcbiAgfTtcblxuICByZW5kZXJTbGlkZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkZC1tb2RlbF9fZm9ybScpO1xuXG4gIGNvbnN0IGVtYWlsSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT0nZW1haWwnXVwiKTtcbiAgY29uc3QgZW1haWxFcnJvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtbW9kZWxfX2VtYWlsLWVycm9yJyk7XG5cbiAgY29uc3QgYnJhbmRJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lPSdicmFuZCddXCIpO1xuICBjb25zdCBicmFuZEVycm9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkZC1tb2RlbF9fYnJhbmQtZXJyb3InKTtcblxuICBjb25zdCBtb2RlbElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9J21vZGVsJ11cIik7XG4gIGNvbnN0IG1vZGVsRXJyb3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19tb2RlbC1lcnJvcicpO1xuXG4gIGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFt0eXBlPSdmaWxlJ11cIik7XG5cbiAgY29uc3QgY2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19hZ3JlZW1lbnQtaW5wdXQnKTtcblxuICBjb25zdCBzdWJtaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19zdWJtaXQnKTtcblxuICBjb25zdCBwcm9ncmVzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtbW9kZWxfX2ZpbGUtcHJvZ3Jlc3MnKTtcbiAgY29uc3QgYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkZC1tb2RlbF9fYmFyLWN1cnJlbnQnKTtcblxuICBjb25zdCBmaWxlTGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19maWxlLWxhYmVsJyk7XG4gIGNvbnN0IGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtbW9kZWxfX2ZpbGUtd3JhcCcpO1xuXG4gIGNvbnN0IGZpbGVSZXN1bHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19maWxlLXJlc3VsdCcpO1xuICBjb25zdCBmaWxlSW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkZC1tb2RlbF9fZmlsZS1pbWFnZScpO1xuICBjb25zdCBmaWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtbW9kZWxfX2ZpbGUtbmFtZScpO1xuICBjb25zdCBmaWxlQ2xlYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkLW1vZGVsX19maWxlLWNsb3NlJyk7XG5cbiAgaWYgKCFlbWFpbElucHV0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKVxuICB9KTtcblxuICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMgKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfTtcblxuICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSlcbiAgfSk7XG5cbiAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSlcbiAgfSlcblxuICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgIGZpbGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgfTtcblxuICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgZmlsZUxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICB9O1xuXG4gIC8vXG5cbiAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wLCBmYWxzZSlcblxuICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICBsZXQgZHQgPSBlLmRhdGFUcmFuc2ZlclxuICAgIGxldCBmaWxlcyA9IGR0LmZpbGVzXG5cbiAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuXG4gICAgICBmaWxlUmVzdWx0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAgIGZpbGVOYW1lLnRleHRDb250ZW50ID0gJyc7XG4gICAgICBmaWxlSW1nLnJlbW92ZUF0dHJpYnV0ZSgnc3JjJyk7XG4gICAgfVxuXG4gICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgb25GaWxlQ2hhbmdlKCk7XG5cbiAgICAvL2hhbmRsZUZpbGVzKGZpbGVzKVxuICB9O1xuXG4gIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgfVxuXG4gIGNvbnN0IGFkZENsYXNzTmFtZSA9IChlbGVtZW50LCBjbGFzc05hbWUpID0+IHtcbiAgICBpZiAoIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSkpIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW1vdmVDbGFzc05hbWUgPSAoZWxlbWVudCwgY2xhc3NOYW1lKSA9PiB7XG4gICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSkpIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBlbmFibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICB9O1xuXG4gIGNvbnN0IGRpc2FibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIH07XG5cbiAgY29uc3QgaXNGb3JtRmlsbGVkID0gKCkgPT4ge1xuICAgIHJldHVybiBlbWFpbElucHV0LnZhbGlkaXR5LnZhbGlkXG4gICAgICAmJiBicmFuZElucHV0LnZhbHVlICE9PSAnJ1xuICAgICAgJiYgbW9kZWxJbnB1dC52YWx1ZSAhPT0gJydcbiAgICAgICYmIGNoZWNrYm94LmNoZWNrZWRcbiAgfTtcblxuICBjb25zdCBjaGVja0Zvcm0gPSAoKSA9PiB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICBlbmFibGVCdXR0b24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlzYWJsZUJ1dHRvbigpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZWFkVXJsID0gKGlucHV0KSA9PiB7XG4gICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcHJvZ3Jlc3MuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgICAgfVxuXG4gICAgICByZWFkZXIub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwKSk7XG4gICAgICAgIGJhci5zdHlsZS53aWR0aCA9IE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwKSArICclJztcbiAgICAgIH1cblxuICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGZpbGVJbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBlLnRhcmdldC5yZXN1bHQpO1xuICAgICAgICBmaWxlTmFtZS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgICFmaWxlUmVzdWx0LmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpICYmIGZpbGVSZXN1bHQuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuXG4gICAgICAgIHByb2dyZXNzLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAgICAgYmFyLnN0eWxlLndpZHRoID0gMDtcbiAgICAgIH1cblxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uVGV4dEZvY3VzID0gKGV2dCkgPT4ge1xuICAgIGNvbnN0IGlucHV0ID0gZXZ0LnRhcmdldDtcblxuICAgIGFkZENsYXNzTmFtZShpbnB1dCwgJ2ZpbGwnKTtcblxuICAgIGlmIChpbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGFkZENsYXNzTmFtZShpbnB1dCwgJ21hc2snKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgb25UZXh0Qmx1ciA9IChldnQpID0+IHtcbiAgICBjb25zdCBpbnB1dCA9IGV2dC50YXJnZXQ7XG5cbiAgICBpZiAoIWlucHV0LnZhbHVlKSB7XG4gICAgICByZW1vdmVDbGFzc05hbWUoaW5wdXQsICdmaWxsJyk7XG4gICAgfVxuXG4gICAgcmVtb3ZlQ2xhc3NOYW1lKGlucHV0LCAnbWFzaycpO1xuICB9XG5cbiAgY29uc3Qgb25FbWFpbElucHV0ID0gKGV2dCkgPT4ge1xuICAgIGNvbnN0IGlucHV0ID0gZXZ0LnRhcmdldDtcblxuICAgIC8vIGlmIChpbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAvLyAgIGFkZENsYXNzTmFtZShpbnB1dCwgJ21hc2snKTtcbiAgICAvLyAgIGFkZENsYXNzTmFtZShpbnB1dCwgJ2Vycm9yJyk7XG4gICAgLy8gfVxuXG4gICAgaWYgKCFlbWFpbElucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICBhZGRDbGFzc05hbWUoZW1haWxFcnJvciwgJ3Nob3cnKTtcbiAgICAgIGFkZENsYXNzTmFtZShlbWFpbElucHV0LCAnZXJyb3InKTtcbiAgICB9XG5cbiAgICBpZiAoZW1haWxJbnB1dC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgcmVtb3ZlQ2xhc3NOYW1lKGlucHV0LCAnZXJyb3InKTtcbiAgICAgIHJlbW92ZUNsYXNzTmFtZShlbWFpbEVycm9yLCAnc2hvdycpO1xuICAgIH1cblxuICAgIGlmIChpbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGFkZENsYXNzTmFtZShpbnB1dCwgJ21hc2snKTtcbiAgICB9XG5cbiAgICBpZiAoaW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICByZW1vdmVDbGFzc05hbWUoaW5wdXQsICdtYXNrJyk7XG4gICAgfVxuXG4gICAgY2hlY2tGb3JtKCk7XG4gIH1cblxuICBjb25zdCBvbkJyYW5kSW5wdXQgPSAoZXZ0KSA9PiB7XG4gICAgY29uc3QgaW5wdXQgPSBldnQudGFyZ2V0O1xuXG4gICAgaWYgKGlucHV0LnZhbHVlID09PSAnJykge1xuICAgICAgYWRkQ2xhc3NOYW1lKGlucHV0LCAnbWFzaycpO1xuICAgICAgYWRkQ2xhc3NOYW1lKGlucHV0LCAnZXJyb3InKTtcbiAgICAgIGFkZENsYXNzTmFtZShicmFuZEVycm9yLCAnc2hvdycpO1xuICAgIH1cblxuICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gJycpIHtcbiAgICAgIHJlbW92ZUNsYXNzTmFtZShpbnB1dCwgJ21hc2snKTtcbiAgICAgIHJlbW92ZUNsYXNzTmFtZShpbnB1dCwgJ2Vycm9yJyk7XG4gICAgICByZW1vdmVDbGFzc05hbWUoYnJhbmRFcnJvciwgJ3Nob3cnKTtcbiAgICB9XG5cbiAgICBjaGVja0Zvcm0oKTtcbiAgfVxuXG4gIGNvbnN0IG9uTW9kZWxJbnB1dCA9IChldnQpID0+IHtcbiAgICBjb25zdCBpbnB1dCA9IGV2dC50YXJnZXQ7XG5cbiAgICBpZiAoaW5wdXQudmFsdWUgPT09ICcnKSB7XG4gICAgICBhZGRDbGFzc05hbWUoaW5wdXQsICdtYXNrJyk7XG4gICAgICBhZGRDbGFzc05hbWUoaW5wdXQsICdlcnJvcicpO1xuICAgICAgYWRkQ2xhc3NOYW1lKG1vZGVsRXJyb3IsICdzaG93Jyk7XG4gICAgfVxuXG4gICAgaWYgKGlucHV0LnZhbHVlICE9PSAnJykge1xuICAgICAgcmVtb3ZlQ2xhc3NOYW1lKGlucHV0LCAnbWFzaycpO1xuICAgICAgcmVtb3ZlQ2xhc3NOYW1lKGlucHV0LCAnZXJyb3InKTtcbiAgICAgIHJlbW92ZUNsYXNzTmFtZShtb2RlbEVycm9yLCAnc2hvdycpO1xuICAgIH1cblxuICAgIGNoZWNrRm9ybSgpO1xuICB9XG5cbiAgY29uc3Qgb25GaWxlQ2xlYXIgPSAoKSA9PiB7XG4gICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIH1cblxuICAgIGZpbGVSZXN1bHQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIGZpbGVOYW1lLnRleHRDb250ZW50ID0gJyc7XG4gICAgZmlsZUltZy5yZW1vdmVBdHRyaWJ1dGUoJ3NyYycpO1xuICB9XG5cbiAgY29uc3Qgb25GaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgfVxuXG4gIGNvbnN0IG9uQ2hlY2tib3hDbGljayA9ICgpID0+IHtcbiAgICAhY2hlY2tib3guY2hlY2tlZFxuICAgICAgPyBhZGRDbGFzc05hbWUoY2hlY2tib3gsICdlcnJvcicpXG4gICAgICA6IHJlbW92ZUNsYXNzTmFtZShjaGVja2JveCwgJ2Vycm9yJyk7XG5cbiAgICBjaGVja0Zvcm0oKTtcbiAgfVxuXG4gIGNvbnN0IG9uU3VibWl0ID0gKGV2dCkgPT4ge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgZm9ybS5zdWJtaXQoKTtcbiAgfVxuXG4gIGVtYWlsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBvblRleHRGb2N1cyk7XG4gIGVtYWlsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIG9uVGV4dEJsdXIpO1xuICBlbWFpbElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25FbWFpbElucHV0KTtcblxuICBicmFuZElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgb25UZXh0Rm9jdXMpO1xuICBicmFuZElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBvblRleHRCbHVyKTtcbiAgYnJhbmRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uQnJhbmRJbnB1dCk7XG5cbiAgbW9kZWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIG9uVGV4dEZvY3VzKTtcbiAgbW9kZWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgb25UZXh0Qmx1cik7XG4gIG1vZGVsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbk1vZGVsSW5wdXQpO1xuXG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG5cbiAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNoZWNrYm94Q2xpY2spO1xuXG4gIHN1Ym1pdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uU3VibWl0KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCAkd2FybmluZyA9ICQoXCIuZGV2aWNlX193YXJuaW5nLWljb25cIik7XG4gIGNvbnN0ICRjaGlwID0gJChcIi5kZXZpY2VfX3N0cm9rZS1jaGlwXCIpO1xuICBjb25zdCAkcG9wdXBDYWJsZSA9ICQoXCIuZGV2aWNlX19zdHJva2UtcG9wdXBcIik7XG4gIGNvbnN0ICRwb3B1cFdhcm5pbmcgPSAkKFwiLmRldmljZV9fd2FybmluZy1wb3B1cFwiKTtcblxuICAkd2FybmluZy5vbihcIm1vdXNlZW50ZXJcIiwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRwb3B1cCA9ICQodGhpcykubmV4dCgpO1xuICAgIGNvbnN0IG9mZnNldCA9XG4gICAgICAkcG9wdXAub2Zmc2V0KCkubGVmdCArICRwb3B1cC5vdXRlcldpZHRoKCkgLSAkKHdpbmRvdykub3V0ZXJXaWR0aCgpO1xuXG4gICAgaWYgKG9mZnNldCA+IDApIHtcbiAgICAgICRwb3B1cC5jc3MoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGVYKGNhbGMoLTEwMCUgKyA0MHB4KSlcIik7XG4gICAgfVxuICB9KTtcblxuICAkd2FybmluZy5vbihcIm1vdXNlbGVhdmVcIiwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRwb3B1cCA9ICQodGhpcykubmV4dCgpO1xuICAgICRwb3B1cC5jc3MoXCJ0cmFuc2Zvcm1cIiwgXCJcIik7XG4gIH0pO1xuXG4gICRjaGlwLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRwb3B1cCA9ICQodGhpcykubmV4dCgpO1xuXG4gICAgJHBvcHVwLmFkZENsYXNzKFwib3BlbmVkXCIpO1xuICB9KTtcblxuICAkcG9wdXBDYWJsZS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKFxuICAgICAgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJkZXZpY2VfX3N0cm9rZS1wb3B1cFwiKSB8fFxuICAgICAgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJkZXZpY2VfX3N0cm9rZS1wb3B1cC1jbG9zZVwiKSB8fFxuICAgICAgJChlLnRhcmdldCkucGFyZW50cyhcIi5kZXZpY2VfX3N0cm9rZS1wb3B1cC1jbG9zZVwiKS5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKFwib3BlbmVkXCIpO1xuICAgIH1cbiAgfSk7XG5cbiAgJHdhcm5pbmcub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgJHBvcHVwID0gJCh0aGlzKS5uZXh0KCk7XG5cbiAgICAkcG9wdXAuYWRkQ2xhc3MoXCJvcGVuZWRcIik7XG4gIH0pO1xuXG4gICRwb3B1cFdhcm5pbmcub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChcbiAgICAgICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiZGV2aWNlX193YXJuaW5nLXBvcHVwXCIpIHx8XG4gICAgICAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImRldmljZV9fc3Ryb2tlLXBvcHVwLWNsb3NlXCIpIHx8XG4gICAgICAkKGUudGFyZ2V0KS5wYXJlbnRzKFwiLmRldmljZV9fc3Ryb2tlLXBvcHVwLWNsb3NlXCIpLmxlbmd0aCA+IDBcbiAgICApIHtcbiAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJvcGVuZWRcIik7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBzd2lwZXIgPSBuZXcgU3dpcGVyKFwiLm1vZGVsX19pbWFnZS1jb250YWluZXJcIiwge1xuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiBcIi5tb2RlbF9faW1hZ2UtY29udGFpbmVyIC5tb2RlbF9fcGFnaW5hdGlvblwiLFxuICAgICAgdHlwZTogXCJidWxsZXRzXCIsXG4gICAgICBjbGlja2FibGU6IHRydWUsXG4gICAgfSxcbiAgICBsb29wOiB0cnVlLFxuICB9KTtcbn0pKCk7XG4iXX0=
